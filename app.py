import streamlit as st
import numpy as np
from sklearn.tree import DecisionTreeClassifier

# Page config
st.set_page_config(page_title="Progression Predictor", page_icon="üî¨")

# Training data (embedded)
X_data = [[2.4765384197235107, 0.10436001420021057, 1.916922688484192], [1.2809338569641113, 3.465735912322998, 2.1747517585754395], [0.7793248295783997, 3.610917806625366, 1.5475624799728394], [0.47623419761657715, 4.4995317459106445, 6.347389221191406], [3.591817617416382, 2.5915164947509766, 5.848171234130859], [6.196444034576416, 2.2772672176361084, 5.3003153800964355], [2.2512917518615723, 2.2512917518615723, 5.205653667449951], [2.079441547393799, 3.5931942462921143, 2.94968843460083], [3.762362241744995, 4.728272438049316, 2.94968843460083], [0.40546512603759766, 3.32503604888916, 3.526360511779785], [2.9856820106506348, 4.205438613891602, 3.301377058029175], [3.3428618907928467, 4.656338691711426, 2.944438934326172], [3.0106208324432373, 7.973499774932861, 3.885679006576538], [4.276666164398193, 4.741447925567627, 3.2288260459899902], [6.541029930114746, 3.7932395935058594, 3.3945083618164062], [3.875359058380127, 5.03825044631958, 2.7536606788635254], [3.7864596843719482, 4.166665077209473, 2.797281265258789], [4.828313827514648, 4.808111190795898, 2.94968843460083], [4.056988716125488, 5.379897117614746, 2.895911931991577], [3.7376697063446045, 3.7864596843719482, 2.884800672531128], [3.1696856021881104, 4.4995317459106445, 3.1000924110412598], [2.186051368713379, 3.8416004180908203, 2.6318888664245605], [2.7911651134490967, 4.122283935546875, 2.933856725692749], [6.903747081756592, 6.0258660316467285, 2.844909429550171], [3.2733640670776367, 4.458987712860107, 3.117949962615967], [3.6082115173339844, 5.20948600769043, 2.990719795227051], [4.969813346862793, 4.4995317459106445, 2.94968843460083], [3.762362241744995, 7.724888324737549, 3.9852733612060547], [13.815511703491211, 8.102889060974121, 2.94968843460083], [4.116595268249512, 4.538496017456055, 2.7942278385162354], [5.342334270477295, 4.247065544128418, 6.0725836753845215], [5.545177459716797, 5.190732002258301, 2.6390573978424072], [6.324358940124512, 5.288267135620117, 2.5136561393737793], [4.15731954574585, 8.523374557495117, 2.8791983127593994], [5.023880481719971, 4.4995317459106445, 2.94968843460083], [4.573679447174072, 5.158480167388916, 3.1696856021881104]]
y_data = [0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]

# Train model on startup (cached)
@st.cache_resource
def train_model():
    model = DecisionTreeClassifier(
        criterion='gini',
        max_depth=2,
        min_samples_split=4,
        min_samples_leaf=3,
        class_weight='balanced',
        random_state=42
    )
    X = np.array(X_data)
    y = np.array(y_data)
    model.fit(X, y)
    return model

model = train_model()

st.title("üî¨ Progression Predictor")
st.write("Enter the three biomarker values to predict progression probability.")

# Input fields
col1, col2, col3 = st.columns(3)


with col1:
    b1tp53 = st.number_input("B1TP53", value=0.0, format="%.4f")

with col2:
    b2mdm2 = st.number_input("B2MDM2", value=0.0, format="%.4f")

with col3:
    cfdnab3 = st.number_input("cfDNAB3", value=0.0, format="%.4f")

# Predict button
if st.button("Predict", type="primary"):
    # Create input array
    input_data = np.array([[b1tp53, b2mdm2, cfdnab3]], dtype=np.float32)

    # Apply log1p transformation (same as training)
    input_data = np.log1p(input_data)
    
    # Get prediction
    prediction = model.predict(input_data)[0]
    probability = model.predict_proba(input_data)[0]
    
    # Display results
    st.divider()
    
    if prediction > 0.5:
        st.error(f"‚ö†Ô∏è Prediction: Progression likely")
    else:
        st.success(f"‚úÖ Prediction: Progression unlikely")
    
    st.write(f"**Probability of no progression:** {probability[0]:.1%}")
    st.write(f"**Probability of progression:** {probability[1]:.1%}")
